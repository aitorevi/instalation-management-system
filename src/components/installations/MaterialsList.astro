---
import Button from '../ui/Button.astro';
import type { Material } from '../../lib/queries/materials';

interface Props {
  materials: Material[];
  installationId: string;
  editable?: boolean;
}

const { materials, editable = false } = Astro.props;

function formatDate(dateStr: string): string {
  return new Date(dateStr).toLocaleDateString('es-ES', {
    day: 'numeric',
    month: 'short',
    hour: '2-digit',
    minute: '2-digit'
  });
}
---

<div class="space-y-4">
  {
    editable && (
      <form method="POST" class="flex gap-2">
        <input type="hidden" name="_action" value="add_material" />
        <input
          type="text"
          name="description"
          placeholder="Añadir material utilizado..."
          required
          class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
        />
        <Button type="submit" size="sm">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"
            />
          </svg>
          Añadir
        </Button>
      </form>
    )
  }

  {
    materials.length > 0 ? (
      <ul class="space-y-2">
        {materials.map((material) => (
          <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <div class="flex-1 min-w-0">
              <p class="text-gray-900">{material.description}</p>
              <p class="text-xs text-gray-500 mt-0.5">{formatDate(material.created_at)}</p>
            </div>

            {editable && (
              <form method="POST" class="ml-4">
                <input type="hidden" name="_action" value="delete_material" />
                <input type="hidden" name="material_id" value={material.id} />
                <button
                  type="submit"
                  class="p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors"
                  title="Eliminar material"
                  aria-label={`Eliminar material ${material.description}`}
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                    />
                  </svg>
                </button>
              </form>
            )}
          </li>
        ))}
      </ul>
    ) : (
      <p class="text-gray-500 text-sm py-4 text-center">No hay materiales registrados</p>
    )
  }
</div>
